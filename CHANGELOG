Big restructure of code base.